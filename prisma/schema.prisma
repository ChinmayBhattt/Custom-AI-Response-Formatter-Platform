generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "sqlite"
}

model User {
  id              String        @id @default(cuid())
  name            String
  email           String        @unique
  password        String
  defaultFormatId String?
  theme           String        @default("dark")
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  chats           Chat[]
  formats         Format[]      @relation("UserFormats")
  formatUsages    FormatUsage[]
}

model Format {
  id          String        @id @default(cuid())
  name        String
  pattern     String
  prefix      String        @default("")
  description String        @default("")
  isBuiltIn   Boolean       @default(false)
  userId      String?
  createdAt   DateTime      @default(now())
  user        User?         @relation("UserFormats", fields: [userId], references: [id])
  chats       Chat[]
  messages    Message[]
  usages      FormatUsage[]
}

model Chat {
  id        String    @id @default(cuid())
  title     String    @default("New Chat")
  userId    String
  formatId  String
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  format    Format    @relation(fields: [formatId], references: [id])
  messages  Message[]
}

model Message {
  id               String   @id @default(cuid())
  chatId           String
  role             String
  rawContent       String
  formattedContent String
  formatId         String?
  createdAt        DateTime @default(now())
  chat             Chat     @relation(fields: [chatId], references: [id], onDelete: Cascade)
  format           Format?  @relation(fields: [formatId], references: [id])
}

model FormatUsage {
  id       String   @id @default(cuid())
  userId   String
  formatId String
  duration Int      @default(0)
  usedAt   DateTime @default(now())
  user     User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  format   Format   @relation(fields: [formatId], references: [id])
}
